"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=13)}([function(e,t,i){function n(){}function r(e,t,i){var n=e._eventable_registry;return t in n?n[t]:i?n[t]=[]:null}t.a=n,n.prototype._initEventable=function(){this._eventable_registry={}},n.prototype.on=function(e,t,i){return r(this,e,!0).push({handler:t,ctx:i}),this},n.prototype.off=function(e,t,i){var n=r(this,e);if(n)for(var o=0,a=n.length;o!==a;o++)if(n[o].handler===t&&n[o].ctx===i)return n.splice(o,1),this;return this},n.prototype.trigger=function(e,t){var i=r(this,e);if(i)for(var n=i.slice(),o=0,a=n.length;o!==a;o++)n[o].handler.call(n[o].ctx,t);return this}},function(e,t,i){function n(e,t){for(var i in t.prototype)e.prototype[i]=t.prototype[i];return e}t.a=n},function(e,t,i){var n=i(1),r=i(0),o=function(){function e(){_classCallCheck(this,e),this._initEventable(),this.filter="all"}return _createClass(e,[{key:"onChange",value:function(e,t){this.on("filterChanged",function(i){e.call(t,{filter:i})})}},{key:"setFilter",value:function(e){return this.filter=e,this.trigger("filterChanged",e),this}},{key:"getFilter",value:function(){return this.filter}}]),e}();i.i(n.a)(o,r.a);var a=new o;t.a=a},function(e,t,i){var n=i(1),r=i(0),o=function(){function e(t){_classCallCheck(this,e),this._initEventable(),this._root=t,this._input=t.querySelector(".js-todo-add_input"),this._selectAllBtnWrapper=t.querySelector(".todo-add_select-all"),this._selectAllBtn=t.querySelector(".js-todo-add_select-all"),this._input.addEventListener("keypress",this),this._selectAllBtnWrapper.addEventListener("keypress",this),this._selectAllBtn.addEventListener("click",this)}return _createClass(e,[{key:"_onSelectAll",value:function(){return this.trigger("selectAll")}},{key:"_onTodoAdd",value:function(){var e=this._input.value.trim();if(0!==e.length)return this._input.value="",this._input.blur(),this.trigger("todoCreate",{text:e})}},{key:"getRoot",value:function(){return this._root}},{key:"handleEvent",value:function(e){switch(e.type){case"click":this._onSelectAll();break;case"keypress":13===e.keyCode&&(e.target.closest(".js-todo-add_input")?this._onTodoAdd():e.target.closest(".todo-add_select-all")&&this._onSelectAll())}}}]),e}();t.a=o,i.i(n.a)(o,r.a)},function(e,t,i){var n=function(){function e(t){_classCallCheck(this,e),this._root=t,this._todosMain=t.querySelector(".js-todos-main")}return _createClass(e,[{key:"updateInterfaceVisibility",value:function(e){return e?this._todosMain.classList.remove("__empty"):this._todosMain.classList.add("__empty"),this}},{key:"getRoot",value:function(){return this._root}}]),e}();t.a=n},function(e,t,i){var n=i(1),r=i(0),o=i(14),a=function(){function e(t){_classCallCheck(this,e),this._initEventable(),this._root=t,this._counter=t.querySelector(".js-left-counter"),this._clearCompletedBtn=t.querySelector(".js-todos-actions-bar_clear-completed"),this._filters=new o.a(t.querySelector(".js-todos-actions-bar_filters")),this._filters.on("filterSelect",this._onFilterSelected,this),this._clearCompletedBtn.addEventListener("click",this)}return _createClass(e,[{key:"_onFilterSelected",value:function(e){return this.trigger("filterSelected",e)}},{key:"_onClearCompleted",value:function(){return this.trigger("clearCompleted")}},{key:"setLeftTodosCount",value:function(e){return this._counter.innerHTML=e+"&nbsp;"+(1===e?"item":"items")+"&nbsp;left",this}},{key:"manageClearCompletedVisibility",value:function(e){return e?this._clearCompletedBtn.classList.remove("__hide"):this._clearCompletedBtn.classList.add("__hide"),this}},{key:"handleEvent",value:function(e){switch(e.type){case"click":this._onClearCompleted()}}}]),e}();t.a=a,i.i(n.a)(a,r.a)},function(e,t,i){var n=i(1),r=i(0),o=i(15),a=i(2),s=function(){function e(t){_classCallCheck(this,e),this._initEventable(),this._root=t,this._items=[],this._left=0}return _createClass(e,[{key:"getTodosCount",value:function(){return this._items.length}},{key:"addTodo",value:function(e){var t=new o.a(e);return this._items.push(t),t.on("todoChange",this._onTodoChange,this).render(this._root),this.filterShowedItems(),this}},{key:"clearCompleted",value:function(){for(var e=0,t=this._items.length;e!==t;e++)this._items[e]._model.get("isReady")&&this._items[e].remove();return this}},{key:"_getItemById",value:function(e){for(var t=0,i=this._items.length;t!==i;t++)if(this._items[t]._model.get("id")===e)return this._items[t];return null}},{key:"_onTodoChange",value:function(){return this.filterShowedItems(a.a.getFilter()),this}},{key:"remove",value:function(e){var t=this._getItemById(e.get("id"));if(t){t.off("todoChange",this._onTodoChange,this),t.remove();var i=this._items.indexOf(t);this._items.splice(i,1)}return this}},{key:"selectAll",value:function(){return this._items.forEach(function(e){e.changeReady(!0)}),this}},{key:"filterShowedItems",value:function(e){return e||(e=a.a.getFilter()),this._items.forEach(function(t){switch(e){case"all":t.visible(!0);break;case"completed":t.visible(t._model.get("isReady"));break;case"active":t.visible(!t._model.get("isReady"))}}),this}},{key:"getRoot",value:function(){return this._root}}]),e}();t.a=s,i.i(n.a)(s,r.a)},function(e,t,i){var n=i(1),r=i(0),o=i(17),a=i(16),s=i(11),l=new o.a,d=function(){function e(){_classCallCheck(this,e),this._initEventable(),this._items_models=[],this._left=0}return _createClass(e,[{key:"updateList",value:function(){var e=this;l.getEntriesList().then(function(t){for(var i=t,n=0,r=i.length;n<r;n++)e.add(i[n],!0);for(var o=0,a=e._items_models.length;o<a;o++)e._items_models[o].get("isReady")&&(e._items_models[o].set("isReady",!1),e._items_models[o].set("isReady",!0))}).catch(function(){for(var t=[],i=void 0,n=0,r=e._items_models.length;n<r;n++)i=e._items_models[n],t.push({id:i.get("id"),isReady:i.get("isReady"),text:i.get("text")});l.putEntriesList(t)})}},{key:"getList",value:function(){return this._items_models}},{key:"getLeftTodosCount",value:function(){return this._left}},{key:"onChange",value:function(e,t){var i=this;return this.on("todoAdd",e).on("todoRemoved",e).on("todoChange",e).on("modelReadyChange",function(n){switch(n.get("isReady")){case!0:0!==i._left&&(i._left-=1);break;case!1:i._left+=1}i.trigger("todoChange"),e.call(t)},this).on("modelRemove",function(n){i.remove(n.get("id")),i.trigger("todoChange"),e.call(t)},this).on("modelChange",function(){i.trigger("todoChange"),e.call(t)},this),this}},{key:"add",value:function(e,t){var i=this,n=void 0;return n=e.id?new a.a(e):new a.a(Object.assign({id:s()},e)),n.onAnyChange(function(e){switch(e.field){case"text":i.trigger("modelTextChange",n);break;case"isReady":i.trigger("modelReadyChange",n);break;case"deleted":i.trigger("modelRemove",n);break;default:i.trigger("modelChange",n)}l.changeListItem({id:n.get("id"),isReady:n.get("isReady"),text:n.get("text")})},this),this._items_models.push(n),!1===n.get("isReady")&&(this._left+=1),t||l.addListItem({id:n.get("id"),isReady:n.get("isReady"),text:n.get("text")}),this.trigger("todoAdd",n),this}},{key:"_getModelById",value:function(e){for(var t=0,i=this._items_models.length;t!==i;t++)if(this._items_models[t].get("id")===e)return this._items_models[t];return null}},{key:"remove",value:function(e){var t=this._getModelById(e);if(t){t.get("isReady")||(this._left-=1),this.trigger("todoRemove",t),t.off("modelFieldChange",this);var i=this.getList().indexOf(t);this.getList().splice(i,1),l.removeListItem(e),this.trigger("todoRemoved")}return this}},{key:"clearCompleted",value:function(){for(var e=this.getList().slice(),t=0,i=e.length;t!==i;t++)e[t].get("isReady")&&this.remove(e[t].get("id"));return this}},{key:"selectAll",value:function(){for(var e=this.getList(),t=0,i=e.length;t!==i;t++)e[t].set("isReady",!0);return this}}]),e}();t.a=d,i.i(n.a)(d,r.a)},function(e,t,i){var n={},r=window.navigator.userAgent.toLowerCase(),o=function(e){return-1!==r.indexOf(e)};n.ios=function(){return n.iphone()||n.ipod()||n.ipad()},n.iphone=function(){return!n.windows()&&o("iphone")},n.ipod=function(){return o("ipod")},n.ipad=function(){return o("ipad")},n.android=function(){return!n.windows()&&o("android")},n.androidPhone=function(){return n.android()&&o("mobile")},n.androidTablet=function(){return n.android()&&!o("mobile")},n.blackberry=function(){return o("blackberry")||o("bb10")||o("rim")},n.blackberryPhone=function(){return n.blackberry()&&!o("tablet")},n.blackberryTablet=function(){return n.blackberry()&&o("tablet")},n.windows=function(){return o("windows")},n.windowsPhone=function(){return n.windows()&&o("phone")},n.windowsTablet=function(){return n.windows()&&o("touch")&&!n.windowsPhone()},n.fxos=function(){return(o("(mobile;")||o("(tablet;"))&&o("; rv:")},n.fxosPhone=function(){return n.fxos()&&o("mobile")},n.fxosTablet=function(){return n.fxos()&&o("tablet")},n.meego=function(){return o("meego")},n.cordova=function(){return window.cordova&&"file:"===location.protocol},n.nodeWebkit=function(){return"object"===_typeof(window.process)},n.mobile=function(){return n.androidPhone()||n.iphone()||n.ipod()||n.windowsPhone()||n.blackberryPhone()||n.fxosPhone()||n.meego()},n.tablet=function(){return n.ipad()||n.androidTablet()||n.blackberryTablet()||n.windowsTablet()||n.fxosTablet()},n.desktop=function(){return!n.tablet()&&!n.mobile()},t.a=n},function(e,t){function i(e,t){var i=t||0,r=n;return r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]}for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=i},function(e,t,i){(function(t){var i,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var r=new Uint8Array(16);i=function(){return n.getRandomValues(r),r}}if(!i){var o=new Array(16);i=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}e.exports=i}).call(t,i(12))},function(e,t,i){function n(e,t,i){var n=t&&i||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[n+s]=a[s];return t||o(a)}var r=i(10),o=i(9);e.exports=n},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(i=window)}e.exports=i},function(e,t,i){function n(){a.a.desktop()&&(document.body.className="hover");var e=new s.a,t=document.querySelector(".main-wrapper"),i=new l.a(t),n=new d.a(t.querySelector(".todo-add")),r=new u.a(t.querySelector(".js-todos-list")),o=new c.a(t.querySelector(".todos-actions-bar"));h.a.onChange(function(e){r.filterShowedItems(e.filter)}),e.onChange(function(){0!==e.getList().length?i.updateInterfaceVisibility(!0):i.updateInterfaceVisibility(!1);var t=e.getLeftTodosCount();o.setLeftTodosCount(t),e.getList().length-t>0?o.manageClearCompletedVisibility(!0):o.manageClearCompletedVisibility(!1)}),n.on("todoCreate",function(t){e.add(t)}).on("selectAll",function(){e.selectAll()}),e.on("todoAdd",function(e){r.addTodo(e)}).on("todoRemove",function(e){r.remove(e)}).on("todoChange",function(){r.filterShowedItems()}),o.on("clearCompleted",function(){e.clearCompleted()}).on("filterSelected",function(e){h.a.setFilter(e)}),e.updateList()}function r(e){9===e.keyCode&&(document.body.classList.add("user-is-tabbing"),window.removeEventListener("keydown",r),window.addEventListener("mousedown",o))}function o(){document.body.classList.remove("user-is-tabbing"),window.removeEventListener("mousedown",o),window.addEventListener("keydown",r)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(8),s=i(7),l=i(4),d=i(3),u=i(6),c=i(5),h=i(2);window.addEventListener("DOMContentLoaded",n),window.addEventListener("keydown",r)},function(e,t,i){var n=i(1),r=i(0),o=function(){function e(t){_classCallCheck(this,e),this._initEventable(),this._filters=t.querySelectorAll(".filter"),this._activeFilter=null;for(var i=0,n=this._filters.length;i<n;i++)this._filters[i].addEventListener("click",this),this._filters[i].classList.contains("__active")&&(this._activeFilter=this._filters[i])}return _createClass(e,[{key:"_onSetFilter",value:function(e){return this._activeFilter!==e&&(this._activeFilter.classList.remove("__active"),e.classList.add("__active"),this._activeFilter=e,this.trigger("filterSelect",e.dataset.filter)),this}},{key:"handleEvent",value:function(e){switch(e.type){case"click":this._onSetFilter(e.target)}}}]),e}();t.a=o,i.i(n.a)(o,r.a)},function(e,t,i){var n=i(1),r=i(0),o=i(19),a=function(){function e(t){var i=this;_classCallCheck(this,e),this._initEventable();var n=o.a.todoItem({text:t.get("text")});this._root=n.root,this._readyMarkWrapper=n.readyMarkWrapper,this._readyMark=n.readyMark,this._removeWrapper=n.removeWrapper,this._remove=n.remove,this._text=n.text,this._model=t,this._model.onChange("isReady",function(e){i._manageReadyModificator(e.value)},this),this._readyMarkWrapper.addEventListener("keypress",this),this._readyMark.addEventListener("change",this),this._removeWrapper.addEventListener("keypress",this),this._remove.addEventListener("click",this),this._text.addEventListener("blur",this)}return _createClass(e,[{key:"render",value:function(e){return e.appendChild(this._root),this}},{key:"_onSetText",value:function(e){return this._model.get("text")!==e&&(this._text.innerText=e,this._model.set("text",e)),this}},{key:"_manageReadyModificator",value:function(e){return e?this._root.classList.add("__ready"):this._root.classList.remove("__ready"),this._readyMark.checked=e,this}},{key:"changeReady",value:function(e){return e!==this._model.get("isReady")&&(this._model.set("isReady",e),this._manageReadyModificator(e),this.trigger("todoChange",this._model)),this}},{key:"_onRemove",value:function(){this._model.set("deleted",!0)}},{key:"remove",value:function(){return this._root.parentNode.removeChild(this._root),this}},{key:"visible",value:function(e){return e?this._root.classList.remove("__hide"):this._root.classList.add("__hide"),this}},{key:"handleEvent",value:function(e){switch(e.type){case"change":this.changeReady(this._readyMark.checked);break;case"click":e.target===this._remove&&this._onRemove();break;case"blur":this._onSetText(this._text.innerText);break;case"keypress":13===e.keyCode&&(e.target.closest(".todo-item_ready-mark")?(this._readyMark.checked=!this._readyMark.checked,this.changeReady(this._readyMark.checked)):e.target.closest(".todo-item_remove")&&e.target===this._removeWrapper&&this._onRemove())}}}]),e}();t.a=a,i.i(n.a)(a,r.a)},function(e,t,i){var n=i(1),r=i(0),o=function(){function e(t){_classCallCheck(this,e),this._initEventable(),this._model={id:t.id,isReady:t.isReady||!1,text:t.text}}return _createClass(e,[{key:"set",value:function(e,t){return this._model[e]=t,this.trigger("modelFieldChange",{field:e,value:t}),this}},{key:"get",value:function(e){return this._model[e]}},{key:"onChange",value:function(e,t,i){return this.on("modelFieldChange",function(n){n.field===e&&t.call(i,n)},this),this}},{key:"onAnyChange",value:function(e,t){var i=this;return this.on("modelFieldChange",function(n){e.call(t,n),i.trigger("modelChange",i)},this),this}}]),e}();t.a=o,i.i(n.a)(o,r.a)},function(e,t,i){var n=i(18),r=function(){function e(){_classCallCheck(this,e),this.KEY="TODOS"}return _createClass(e,[{key:"getEntriesList",value:function(){var e=this,t=void 0;return new Promise(function(i,r){t=n.a.read(e.KEY),t&&i(t.data),r()})}},{key:"putEntriesList",value:function(e){var t={time:(new Date).getTime(),data:e};return!!n.a.write(this.KEY,t)}},{key:"addListItem",value:function(e){var t=(new Date).getTime(),i=n.a.read(this.KEY);return i||(n.a.write(this.KEY,{time:t,data:[]}),i=n.a.read(this.KEY)),i.time=t,i.data.push(e),!!n.a.write(this.KEY,i)}},{key:"removeListItem",value:function(e){var t=n.a.read(this.KEY);if(t){for(var i=0,r=t.data.length;i<r;i++)if(t.data[i].id===e){t.data.splice(i,1);break}if(n.a.write(this.KEY,t))return!0}return!1}},{key:"changeListItem",value:function(e){var t=n.a.read(this.KEY);if(t){for(var i=0,r=t.data.length;i<r;i++)if(t.data[i].id===e.id){t.data[i]=e;break}if(n.a.write(this.KEY,t))return!0}return!1}}]),e}();t.a=r},function(e,t,i){var n=function(){function e(e){if("undefined"!=typeof Storage){var t={time:null,data:[]};return localStorage.setItem(e,JSON.stringify(t)),!0}return!1}function t(e){return"undefined"!=typeof Storage?JSON.parse(localStorage.getItem(e)):null}function i(e,t){return"undefined"!=typeof Storage&&(localStorage.setItem(e,JSON.stringify(t)),!0)}function n(e){return"undefined"!=typeof Storage&&(localStorage.removeItem(e),!0)}return{read:t,write:i,create:e,clear:n}}();t.a=n},function(e,t,i){function n(e){var t=document.getElementById(e);r.innerHTML=t.innerHTML;var i=r.children[0];return r.removeChild(i),i}var r=document.createElement("div"),o={todoItem:function(e){var t=n("todoItemTemplate"),i=t.querySelector(".todo-item_ready-mark"),r=t.querySelector(".js-todo-item_ready-mark"),o=t.querySelector(".todo-item_remove"),a=t.querySelector(".js-todo-item_remove"),s=t.querySelector(".js-todo-item_text");return e.text&&(s.innerText=e.text),e.isReady&&(r.checked=!0),{root:t,text:s,readyMarkWrapper:i,readyMark:r,removeWrapper:o,remove:a}}};t.a=o}]);